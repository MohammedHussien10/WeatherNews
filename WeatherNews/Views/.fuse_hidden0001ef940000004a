//
//  MapView.swift
//  WeatherNews
//
//  Created by Macos on 05/11/2025.
//

import SwiftUI
import MapKit
struct MapView: View {
    @State private var region = MKCoordinateRegion(center: CLLocationCoordinate2D(latitude: 0.7893, longitude: 21.0936), span: MKCoordinateSpan(latitudeDelta: 80, longitudeDelta: 80))
    
    @State private var selectedCoordinate: CLLocationCoordinate2D?
    @EnvironmentObject var viewModel : HomeViewModel
    @Environment(\.dismiss) private var dismiss
    @State private var isLoading = false
    
    
    var body: some View {
        
        ZStack {
            Map(coordinateRegion: $region, interactionModes: .all,showsUserLocation: true).ignoresSafeArea()
            
            Image(systemName: "mappin.circle.fill")
                .font(.system(size: 45))
                .foregroundColor(.red)
                .offset(y: -20)
            
            VStack {
                Spacer()
                VStack{
                    
                    if let weather = viewModel.currentWeather{
                        
                        Text("\(weather.sys.country.fullCountryName),\(weather.name)").font(.title3)
                    }
                }.foregroundColor(Color.gray)
                Button("Select Location") {
               
                }.frame(maxWidth: 100)
                    .padding()
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(12)
                
            }.frame(maxWidth: .infinity,maxHeight: 300).background(Color.white)
        }
    }
    
    
    func getLocation(){
        selectedCoordinate = region.center
        viewModel.savedLat = region.center.latitude
        viewModel.savedLon = region.center.longitude
        isLoading = true
        Task { @MainActor in
            await viewModel.fetchWeather(
                latitude: viewModel.savedLat,
                longitude: viewModel.savedLon
            )
            
            try? await Task.sleep(nanoseconds: 300_000_000)
                isLoading = false
                dismiss()
            
        }
    }
}


struct Location: Identifiable {
    let id = UUID()
    let name: String
    let coordinate: CLLocationCoordinate2D
}


